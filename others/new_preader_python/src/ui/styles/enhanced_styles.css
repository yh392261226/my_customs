/*
增强样式文件 - 提供更好的样式隔离和重置
解决样式污染问题
*/

/* ===== 样式重置和隔离基础规则 ===== */

/* 为每个屏幕提供基础的样式重置 */
.isolated-screen {
    /* 重置可能冲突的样式属性 */
    box-sizing: border-box;
    position: relative;
    
    /* 确保屏幕占满容器 */
    width: 100%;
    height: 100%;
    
    /* 清除可能的浮动影响 */
    clear: both;
    
    /* 重置字体相关属性 */
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
    
    /* 重置颜色相关属性 */
    color: inherit;
    background: inherit;
}

/* 隔离容器的基础样式 */
.isolated-container {
    box-sizing: border-box;
    position: relative;
}

/* ===== 屏幕特定的命名空间样式 ===== */

/* 欢迎屏幕样式隔离 */
.screen-welcome {
    /* 确保欢迎屏幕的样式不会泄漏 */
}

.screen-welcome * {
    box-sizing: border-box;
}

.screen-welcome #welcome-container {
    width: 100%;
    height: 100%;
    align: center middle;
    content-align: center middle;
}

.screen-welcome #welcome-title {
    text-align: center;
    text-style: bold;
    color: $primary;
    margin-bottom: 1;
}

.screen-welcome #welcome-subtitle {
    text-align: center;
    color: $accent;
    text-style: italic;
    margin-bottom: 1;
}

.screen-welcome #welcome-description {
    text-align: center;
    color: $text-muted;
    margin-bottom: 2;
}

.screen-welcome #features-container {
    width: 100%;
    margin: 2 2 2 2;
    border: round $primary;
    padding: 1;
    align: center middle;
}

.screen-welcome #welcome-buttons {
    layout: horizontal;
    align: center middle;
    margin-bottom: 2;
}

.screen-welcome #welcome-buttons Button {
    margin: 0 1;
    min-width: 8;
}

/* 书架屏幕样式隔离 */
.screen-bookshelf {
    /* 书架屏幕特定样式 */
}

.screen-bookshelf * {
    box-sizing: border-box;
}

.screen-bookshelf Grid {
    width: 100%;
    height: 100%;
    grid-size: 1 3;
    grid-rows: 2fr 12fr 1fr 1fr;
}

.screen-bookshelf DataTable {
    width: 100%;
    height: 80;
}

.screen-bookshelf #bookshelf-title {
    text-align: center;
    text-style: bold;
    color: $primary;
    margin-bottom: 1;
}

.screen-bookshelf #bookshelf-toolbar {
    layout: horizontal;
    align: center middle;
    margin: 1 0;
}

.screen-bookshelf #bookshelf-toolbar Button {
    margin: 0 1;
    min-width: 8;
}

.screen-bookshelf #shortcuts-bar {
    width: 100%;
    height: auto;
    min-height: 3;
    dock: bottom;
    layout: horizontal;
    align-horizontal: center;
    content-align: center middle;
}

.screen-bookshelf #shortcuts-bar Label {
    margin: 0 2;
    text-style: italic;
    color: $text-muted;
}

/* 阅读器屏幕样式隔离 */
.screen-reader {
    /* 阅读器屏幕特定样式 */
}

.screen-reader * {
    box-sizing: border-box;
}

.screen-reader #header {
    dock: top;
    height: 3;
    background: $accent;
    color: $text;
    text-align: center;
    content-align: center middle;
}

.screen-reader #content {
    width: 100%;
    height: 100%;
    margin: 1;
    padding: 1;
    border: round $primary;
    background: $surface;
    color: $text;
}

.screen-reader #buttons {
    dock: bottom;
    height: auto;
    min-height: 3;
    layout: horizontal;
    align: center middle;
    background: $panel;
}

.screen-reader #buttons Button {
    margin: 0 1;
    min-width: 8;
    background: $primary;
    color: $text;
}

.screen-reader #buttons Button:hover {
    background: $primary-lighten-1;
}

.screen-reader #status {
    dock: bottom;
    height: 1;
    background: $panel;
    color: $text-muted;
    text-align: center;
    content-align: center middle;
}

/* 设置屏幕样式隔离 */
.screen-settings {
    /* 设置屏幕特定样式 */
}

.screen-settings * {
    box-sizing: border-box;
}

.screen-settings TabbedContent {
    width: 100%;
    height: 100%;
}

.screen-settings TabPane {
    width: 100%;
    height: 100%;
    padding: 1;
}

.screen-settings .settings-group {
    margin: 1 0;
    padding: 1;
    border: round $secondary;
}

.screen-settings .settings-group-title {
    text-style: bold;
    color: $primary;
    margin-bottom: 1;
}

.screen-settings .setting-item {
    margin: 1 0;
    layout: horizontal;
    align: left middle;
}

.screen-settings .setting-label {
    width: 30%;
    text-align: right;
    margin-right: 2;
}

.screen-settings .setting-control {
    width: 70%;
}

/* 文件资源管理器屏幕样式隔离 */
.screen-fileexplorer {
    /* 文件资源管理器屏幕特定样式 */
}

.screen-fileexplorer * {
    box-sizing: border-box;
}

.screen-fileexplorer DirectoryTree {
    width: 100%;
    height: 100%;
}

.screen-fileexplorer .file-item {
    padding: 0 1;
    margin: 0;
}

.screen-fileexplorer .file-item:hover {
    background: $accent;
    color: $text;
}

/* 统计屏幕样式隔离 */
.screen-statistics {
    /* 统计屏幕特定样式 */
}

.screen-statistics * {
    box-sizing: border-box;
}

.screen-statistics .stats-container {
    width: 100%;
    height: 100%;
    padding: 1;
}

.screen-statistics .stats-section {
    margin: 2 0;
    padding: 1;
    border: round $secondary;
}

.screen-statistics .stats-title {
    text-style: bold;
    color: $primary;
    text-align: center;
    margin-bottom: 1;
}

.screen-statistics .stats-item {
    margin: 1 0;
    layout: horizontal;
    align: left middle;
}

.screen-statistics .stats-label {
    width: 50%;
    text-align: left;
}

.screen-statistics .stats-value {
    width: 50%;
    text-align: right;
    text-style: bold;
    color: $accent;
}

/* ===== 对话框样式隔离 ===== */

/* 通用对话框样式重置 */
Dialog {
    width: auto;
    height: auto;
    background: $panel;
    border: round $primary;
    padding: 1;
}

Dialog * {
    box-sizing: border-box;
}

Dialog .dialog-title {
    text-align: center;
    text-style: bold;
    color: $primary;
    margin-bottom: 1;
}

Dialog .dialog-content {
    width: 100%;
    margin: 1 0;
}

Dialog .dialog-buttons {
    width: 100%;
    layout: horizontal;
    align-horizontal: center;
    margin-top: 1;
}

Dialog .dialog-buttons Button {
    margin: 0 1;
    min-width: 8;
}

/* ===== 防止样式泄漏的通用规则 ===== */

/* 确保每个隔离屏幕的子元素都有正确的盒模型 */
.isolated-screen *,
.isolated-screen *::before,
.isolated-screen *::after {
    box-sizing: border-box;
}

/* 重置可能冲突的全局样式 */
.isolated-screen {
    /* 重置定位 */
    position: relative;
    top: auto;
    left: auto;
    right: auto;
    bottom: auto;
    
    /* 重置变换 */
    transform: none;
    
    /* 重置层级 */
    z-index: auto;
    
    /* 重置溢出 */
    overflow: visible;
}

/* 确保屏幕切换时的平滑过渡 */
.isolated-screen {
    transition: opacity 0.2s ease-in-out;
}

/* 隐藏非活动屏幕 */
.isolated-screen:not(.active) {
    display: none;
}

/* 显示活动屏幕 */
.isolated-screen.active {
    display: block;
    opacity: 1;
}

/* ===== 响应式和适配性样式 ===== */

/* 确保在不同屏幕尺寸下的正确显示 */
@media (max-width: 80) {
    .isolated-screen .horizontal-layout {
        layout: vertical;
    }
    
    .isolated-screen .responsive-button {
        width: 100%;
        margin: 1 0;
    }
}

/* 高对比度模式支持 */
@media (prefers-contrast: high) {
    .isolated-screen {
        border: solid $primary;
    }
    
    .isolated-screen Button {
        border: solid $text;
    }
}

/* 减少动画模式支持 */
@media (prefers-reduced-motion: reduce) {
    .isolated-screen,
    .isolated-screen * {
        transition: none;
        animation: none;
    }
}