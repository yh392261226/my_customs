#!/usr/bin/env bash
###Desc: cat img from url in iterm2
###Author: Json
if [ "$(env | grep 'TERM_PROGRAM=' | sed 's/TERM_PROGRAM=//')" != "iTerm.app" ]; then
    echo "This command can only be used in iterm2 !!!";
    exit 0;
fi

if [ $# -ne 1 ]; then
    echo "Type $0 image_url"
    exit 1;
fi
#imgurl="http://g.hiphotos.baidu.com/image/pic/item/f7246b600c338744b5a0c49b5f0fd9f9d62aa0f4.jpg"
imgurl="$1"
axel -U 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/11.1 Safari/605.1.15' -q -o /tmp/$(basename $imgurl) $imgurl

printf '\033]1337;File=inline=1;width=30%%;preserveAspectRatio=0'
printf ":"
base64 < "/tmp/$(basename $imgurl)"
printf '\a\n'

if [ -f /tmp/$(basename $imgurl) ]; then
    rm -f /tmp/$(basename $imgurl);
fi