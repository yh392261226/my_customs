### Package Desc: è‡ªå®šä¹‰å·¥å…·ç›¸å…³å‘½ä»¤


function create_tmp_aliases() {                                                       # Desc: function: create_tmp_aliases:ä»¥a+æ•°å­—å½¢å¼åˆ›å»ºä¸´æ—¶åˆ«åå‘½ä»¤
    if [ "$#" -gt "0" ]; then
        tmp_command_file=$(mktemp)
        #åˆ›å»ºä¸´æ—¶è„šæœ¬
        n=1
        for tcommand in $argv; do
            echo "alias a${n}=\"${tcommand}\"\n" >> $tmp_command_file
            ((n=n+1))
        done
        if [ -f $tmp_command_file ]; then
            source $tmp_command_file
        fi
    else
        return
    fi
}
alias cta="create_tmp_aliases"                                                        # Desc: alias: cta:create_tmp_aliaseså‘½ä»¤çš„åˆ«å,ä»¥a+æ•°å­—å½¢å¼åˆ›å»ºä¸´æ—¶åˆ«åå‘½ä»¤

function temprature_monitor() {                                                       # Desc: function: temprature_monitor: æ¸©åº¦ç›‘æ§
    $USE_GUM && custom_gum_header --border-foreground 99 "æ¸©åº¦ç›‘æ§" || echo -e "æ¸©åº¦ç›‘æ§"
    while true; do
        
        # å…ˆå®‰è£…: brew install osx-cpu-temp
        if command -v osx-cpu-temp &>/dev/null; then
            temp=$(osx-cpu-temp | grep -oE '[0-9.]+')
            echo "CPU æ¸©åº¦: ${temp}Â°C"
        # é«˜æ¸©è­¦å‘Š
            if (( $(echo "$temp > 80" | bc -l) )); then
                echo "è­¦å‘Š: CPU æ¸©åº¦è¿‡é«˜!"
            fi
        else
            echo "è¯·å…ˆå®‰è£…: brew install osx-cpu-temp"
        fi
    done
}
alias tm="temprature_monitor"                                                         # Desc: alias: tm: temprature_monitorå‘½ä»¤çš„åˆ«åï¼Œæ¸©åº¦ç›‘æ§

function net_port_monitor() {                                                         # Desc: function: net_port_monitor: ç½‘ç»œç«¯å£ç›‘æ§
    # ç›‘æ§ç‰¹å®šç«¯å£
    local text='è¯·è¾“å…¥è¦ç›‘æ§çš„ç«¯å£å· '
    $USE_GUM && port=$(gum input --placeholder "$text") || read -rep "$text" port </dev/tty

    # port=8080

    $USE_GUM && custom_gum_header --border-foreground 99 "ç½‘ç»œç«¯å£ç›‘æ§" || echo -e "ç½‘ç»œç«¯å£ç›‘æ§"
    while true; do
        if lsof -i :$port >/dev/null; then
            echo "$(date) - ç«¯å£ $port æ­£åœ¨ç›‘å¬"
        else
            echo "$(date) - è­¦å‘Š: ç«¯å£ $port æœªç›‘å¬!"
        fi

        # ç›‘æ§ç½‘ç»œå“åº”
        if ping -c1 -t2 8.8.8.8 &>/dev/null; then
            echo "å¤–ç½‘è¿æ¥æ­£å¸¸"
        else
            echo "è­¦å‘Š: å¤–ç½‘è¿æ¥å¤±è´¥!"
        fi
    done
}
alias mnp="net_port_monitor"                                                          # Desc: alias: mnp: net_port_monitorå‘½ä»¤çš„åˆ«åï¼Œç½‘ç»œç«¯å£ç›‘æ§

function disk_monitor() {                                                             # Desc: function: disk_monitor: ç¡¬ç›˜ç›‘æ§
    # æ£€æŸ¥æ ¹ç›®å½•ä½¿ç”¨ç‡
    $USE_GUM && custom_gum_header --border-foreground 99 "ç¡¬ç›˜ç›‘æ§" || echo -e "ç¡¬ç›˜ç›‘æ§"
    while true; do
        disk_usage=$(/bin/df -h / | tail -1 | awk '{print $5}' | tr -d '%')
        threshold=85

        if [[ "$disk_usage" -gt "$threshold" ]]; then
            echo "è­¦å‘Š: æ ¹ç›®å½•ä½¿ç”¨ç‡ ${disk_usage}% > ${threshold}%"
        else
            echo "ç£ç›˜æ­£å¸¸: ${disk_usage}%"
        fi
    done
    # å¯é€‰ï¼šç›‘æ§ç‰¹å®šæŒ‚è½½ç‚¹
    # df -h /Volumes/YourDrive
}
alias dm="disk_monitor"                                                               # Desc: alias: dm: disk_monitorå‘½ä»¤çš„åˆ«åï¼Œç¡¬ç›˜ç›‘æ§

function real_time_cup_memory_monitor() {                                             # Desc: function: real_time_cup_memory_monitor: å®æ—¶ç›‘æ§CPUå’Œå†…å­˜
    # å…¼å®¹ bash å’Œ zsh
    $USE_GUM && custom_gum_header --border-foreground 99 "å®æ—¶ç›‘æ§CPUå’Œå†…å­˜" || echo -e "å®æ—¶ç›‘æ§CPUå’Œå†…å­˜"
    while true; do
        echo "===== $(date) ====="    
        # CPU ä½¿ç”¨ç‡ (macOS é€‚é…)
        cpu_usage=$(ps -A -o %cpu | awk '{s+=$1} END {printf "%.1f%%", s}')
        echo "CPU Usage: $cpu_usage"

        # å†…å­˜ä½¿ç”¨æƒ…å†µ (ä½¿ç”¨ vm_stat)
        total_mem=$(sysctl -n hw.memsize)
        page_size=$(vm_stat | grep 'page size' | awk '{print $8}')
        free_pages=$(vm_stat | grep 'Pages free' | awk '{print $3}' | sed 's/.//g')
        used_mem=$(( (total_mem - (free_pages * page_size)) / 1024 / 1024 ))
        total_mem=$(( total_mem / 1024 / 1024 ))
        echo "Memory: ${used_mem}MB / ${total_mem}MB"

        sleep 2
    done
}
alias rcmm="real_time_cup_memory_monitor"                                             # Desc: alias: rcmm: real_time_cup_memory_monitorå‘½ä»¤çš„åˆ«åï¼Œå®æ—¶ç›‘æ§CPUå’Œå†…å­˜

function fzf_monitor_manager() {                                                      # Desc: function: fzf_monitor_manager: åˆ©ç”¨fzfç®¡ç†ç›‘æ§å‘½ä»¤
    local options=(
        "å®æ—¶CPUå’Œå†…å­˜"
        "ç£ç›˜"
        "è¿›ç¨‹"
        "ç½‘ç»œ"
        "æ¸©åº¦"
        "ğŸ”™ è¿”å›"
    )
    
    $USE_GUM && custom_gum_header --border-foreground 99 "ç›‘æ§ç®¡ç†" || echo -e "ç›‘æ§ç®¡ç†"
    while true; do
        local selection=$(printf '%s\n' "${options[@]}" | fzf \
            --height=30% \
            --reverse \
            --prompt="â¤ ç›‘æ§ > " \
            --preview="echo -e '\n${THEME_PREVIEW}å½“å‰ä¸»é¢˜: ${THEME_NAME}${COLOR_RESET}'" \
            --preview-window="top:3:wrap"
        )
        
        case "$selection" in
            "å®æ—¶CPUå’Œå†…å­˜") real_time_cup_memory_monitor ;;
            "ç£ç›˜") disk_monitor ;;
            "è¿›ç¨‹") process_monitor ;;
            "ç½‘ç»œ") network_monitor ;;
            "æ¸©åº¦") temprature_monitor ;;
            "ğŸ”™ è¿”å›"|*)
                break
                ;;
        esac
    done
}
alias fmm="fzf_monitor_manager"                                                       # Desc: alias: fmm: fzf_monitor_managerå‘½ä»¤çš„åˆ«åï¼Œåˆ©ç”¨fzfç®¡ç†ç›‘æ§å‘½ä»¤

vedio_list_manager() {
    local current_dir=$HOME/data/Vedioes/
    local tmp_current_dir=$PWD
    $USE_GUM && custom_gum_header --border-foreground 99 "è§†é¢‘åˆ—è¡¨" || echo -e "è§†é¢‘åˆ—è¡¨"
    while true; do
        cd $current_dir
        local selection=$(ls $current_dir | awk -v dir="$current_dir" '
                BEGIN { print ".." }
                { print }
                END { print "â†©ï¸ è¿”å›" }
            ' | fzf)
        # å¤„ç†é€‰æ‹©ç»“æœ
        if [[ "$selection" == "â†©ï¸ è¿”å›" ]]; then
            break
        elif [[ "$selection" == ".." ]]; then
            current_dir=$(dirname "$current_dir")
        elif [[ -d "${current_dir}/${selection}" ]]; then
            current_dir="${current_dir}/${selection}"
        else
            $MYRUNTIME/customs/bin/_operator "${current_dir}/${selection}"
        fi
    done
    cd $tmp_current_dir
}

vedio_web_manager() {
    $USE_GUM && custom_gum_header --border-foreground 99 "è§†é¢‘ç½‘ç«™ç®¡ç†" || echo -e "è§†é¢‘ç½‘ç«™ç®¡ç†"
    local vediomark=$MYRUNTIME/tools/m_vedio_mark
    [[ ! -f $vediomark ]] && touch $vediomark
    urls=$(cat "$vediomark" | awk -v dir="$current_dir" '
                { print }
                END { print "â†©ï¸ è¿”å›" }
            ' | fzf \
    --multi \
    --delimiter='#' \
    --with-nth=1 \
    --header="ğŸŒ é€‰æ‹©ç½‘å€ (Tabå¤šé€‰) [${header%%#*}]" \
    --preview='echo "{1}\n{2}"' \
    --preview-window="right:70%:wrap" \
	--height=95% \
    --bind="ctrl-y:execute-silent(printf '%s' {2} | pbcopy)+abort" \
    --bind="ctrl-e:execute(nvim \"$vediomark\" < /dev/tty > /dev/tty)+reload(cat \"$vediomark\")" \
    --bind="ctrl-o:execute(open -R \"$vediomark\")+abort" \
    --bind="ctrl-h:change-preview-label( â•¢ Help Infomation â•Ÿ )+preview($MYRUNTIME/customs/bin/web help)+show-preview" \
    --header-first \
    --prompt="â¤ " | \
    awk -F'#' '{print $2}')
    
    [[ -z "$urls" ]] && return
    local OPENBROWSER='Brave Browser'
    while read -r url; do
        [[ -n "$url" ]] && open -a "$OPENBROWSER" "$url"
    done <<< "$urls"
}

ofen_used_soft_manager() {
    local ofenmark=$MYRUNTIME/tools/m_ofen_used_soft
    [[ ! -f $ofenmark ]] && touch $ofenmark

    $USE_GUM && custom_gum_header --border-foreground 99 "å¸¸ç”¨è½¯ä»¶ç®¡ç†" || echo -e "å¸¸ç”¨è½¯ä»¶ç®¡ç†"
    
    local selection=$(cat $ofenmark | awk -v dir="$FZF_CURRENT_DIR" '
            { print }
            END { print "ğŸ”™ è¿”å›" }
        ' | fzf --reverse \
            --bind="ctrl-o:execute(open {})+abort" \
            --bind="ctrl-e:execute(nvim \"$ofenmark\" < /dev/tty > /dev/tty)+reload(cat \"$ofenmark\" | awk -v dir=\"$FZF_CURRENT_DIR\" '
            { print }
            END { print \"ğŸ”™ è¿”å›\" }
        ')" \
            --prompt="â¤ å¸¸ç”¨è½¯ä»¶ç®¡ç† > ")
    [[ -z "$selection" ]] && return
    [[ "$selection" = "ğŸ”™ è¿”å›" ]] && return
    while read -r selected; do
        [[ -n $selected ]] && open "$selected"
    done <<< $selection
}

fzf_recreation_manager() {
    local options=(
        "è§†é¢‘åˆ—è¡¨"
        "å¸¸çœ‹è§†é¢‘ç½‘ç«™"
        "æ‰“å¼€ç›®å½•"
        "å¸¸ç”¨è½¯ä»¶"
        "â†©ï¸ è¿”å›"
    )
    
    $USE_GUM && custom_gum_header "å¨±ä¹ç®¡ç†" || echo -e "å¨±ä¹ç®¡ç†"
    while true; do
        local selection=$(printf '%s\n' "${options[@]}" | fzf \
            --height=30% \
            --reverse \
            --prompt="â¤ å¨±ä¹ç®¡ç† > "
        )
        
        case $selection in
            *è§†é¢‘åˆ—è¡¨*) vedio_list_manager ;;
            *å¸¸çœ‹è§†é¢‘ç½‘ç«™*) vedio_web_manager ;;
            *æ‰“å¼€ç›®å½•*) open $HOME/data/Vedioes && return ;;
            *å¸¸ç”¨è½¯ä»¶*) ofen_used_soft_manager ;;
            *è¿”å›*|*) break ;;
        esac
    done
}